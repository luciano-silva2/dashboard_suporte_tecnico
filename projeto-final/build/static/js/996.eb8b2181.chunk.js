"use strict";(self.webpackChunkprojeto_final=self.webpackChunkprojeto_final||[]).push([[996],{4996:(e,a,t)=>{t.r(a),t.d(a,{default:()=>p});var i=t(5043),l=t(9615),o=t(2757),n=t(5472),r=t(9847),s=t(9756),c=t(9857),d=t(6156),u=(t(5015),t(579));const m=e=>{let{isOpen:a,onClose:t,children:i}=e;return a?(0,u.jsx)("div",{style:{position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3},onClick:t,children:(0,u.jsxs)("div",{style:{background:"white",padding:"20px",borderRadius:"8px",boxShadow:"0 4px 8px rgba(0, 0, 0, 0.1)",position:"relative",zIndex:2001},onClick:e=>e.stopPropagation(),children:[i,(0,u.jsx)("button",{onClick:t,children:"Close"})]})}):null};function v(e){let{ticket:a,currentUser:t,isFuncionario:l,onAfter:r}=e;const[s,c]=(0,i.useState)(!1),d=(0,i.useMemo)(()=>l&&"aberto"===(null===a||void 0===a?void 0:a.status)&&!(null!==a&&void 0!==a&&a.funcionarioId),[l,a]);return d?(0,u.jsx)("button",{className:"btn btn-warning btn-sm",onClick:async()=>{if(d){c(!0);try{const e=(0,n.H9)(o.k,"tickets",a.id);await(0,n.c4)(o.k,async a=>{const i=await a.get(e);if(!i.exists())throw new Error("Ticket n\xe3o encontrado.");const l=i.data();if(l.funcionarioId)throw new Error("Ticket j\xe1 foi assumido.");if("aberto"!==l.status)throw new Error("Ticket n\xe3o est\xe1 mais aberto.");a.update(e,{funcionarioId:t.uid,status:"em_andamento",assumidoEm:(0,n.O5)(),atualizadoEm:(0,n.O5)()})}),null===r||void 0===r||r()}catch(e){alert(e.message||"Erro ao atender ticket.")}finally{c(!1)}}},disabled:s,title:"Assumir este ticket",children:s?"Assumindo...":"Atender"}):null}function b(e){var a;let{setTicketSelecionado:t,navigate:l,ticketsFiltrados:b,atualizarCampo:h,excluirTicket:p,isFuncionario:x}=e;const[f,g]=(0,i.useState)(!1),[j,k]=(0,i.useState)(null),[C,y]=(0,i.useState)({nome:"",email:"",problema:"",prioridade:null,status:null,tecnico:"",data:new Date}),w=(0,i.useMemo)(()=>[{accessorKey:"nome",header:"Nome"},{accessorKey:"email",header:"Email"},{accessorKey:"problema",header:"Problema"},{accessorKey:"prioridade",header:"Prioridade",Cell:e=>{let{cell:a,row:t}=e;return(0,u.jsx)(c.Ay,{value:r.$G.find(e=>e.value===a.getValue()),onChange:e=>h(t.original.id,"prioridade",e.value),options:r.$G,classNamePrefix:"react-select"})}},{accessorKey:"status",header:"Status",Cell:e=>{let{cell:a,row:t}=e;return(0,u.jsx)(c.Ay,{value:r.FJ.find(e=>e.value===a.getValue()),onChange:e=>h(t.original.id,"status",e.value),options:r.FJ,classNamePrefix:"react-select"})}},{accessorKey:"tecnico",header:"T\xe9cnico"},{accessorKey:"data",header:"Data",Cell:e=>{let{cell:a}=e;return new Date(a.getValue()).toLocaleDateString()}},{accessorKey:"acoes",header:"A\xe7\xf5es",Cell:e=>{let{row:a}=e;return(0,u.jsxs)("div",{className:"d-flex gap-2",children:[(0,u.jsx)("button",{className:"btn btn-info btn-sm",onClick:()=>{k(a.original),g(!0)},children:"Ver Detalhes"}),(0,u.jsx)("button",{className:"btn btn-danger btn-sm",onClick:()=>p(a.original.id),children:"Excluir"}),(0,u.jsx)("button",{className:"btn btn-primary btn-sm",onClick:()=>{l("/chat")},children:"Abrir Chat"}),x&&"aberto"===a.original.status&&!a.original.funcionarioId&&(0,u.jsx)(v,{ticket:a.original,currentUser:o.j.currentUser,isFuncionario:x,onAfter:()=>{}})]})}}],[h,p,x]);return(0,u.jsxs)("div",{className:"container my-4",children:[(0,u.jsx)(m,{isOpen:f,onClose:()=>g(!1),children:j?(0,u.jsxs)("div",{children:[(0,u.jsx)("h5",{children:"Detalhes do Ticket"}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Nome:"})," ",j.nome]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Email:"})," ",j.email]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Problema:"})," ",j.problema]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Prioridade:"})," ",j.prioridade]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Status:"})," ",j.status]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"T\xe9cnico:"})," ",j.tecnico]}),(0,u.jsxs)("p",{children:[(0,u.jsx)("strong",{children:"Data:"})," ",null===(a=j.data)||void 0===a?void 0:a.toLocaleDateString()]})]}):(0,u.jsxs)("div",{children:[(0,u.jsx)("h5",{children:"Criar Novo Ticket"}),(0,u.jsx)("input",{className:"form-control mb-2",placeholder:"Problema",value:C.problema,onChange:e=>y({...C,problema:e.target.value})}),(0,u.jsx)(c.Ay,{options:r.$G,value:C.prioridade,onChange:e=>y({...C,prioridade:e}),placeholder:"Prioridade",classNamePrefix:"react-select"}),(0,u.jsx)(c.Ay,{options:r.FJ,value:C.status,onChange:e=>y({...C,status:e}),placeholder:"Status",classNamePrefix:"react-select"}),(0,u.jsx)("input",{className:"form-control mt-2",placeholder:"T\xe9cnico",value:C.tecnico,onChange:e=>y({...C,tecnico:e.target.value})}),(0,u.jsx)(d.Ay,{selected:C.data,onChange:e=>y({...C,data:e}),className:"form-control mt-2",dateFormat:"dd/MM/yyyy"}),(0,u.jsx)("button",{className:"btn btn-primary mt-3",onClick:async()=>{try{var e,a;await(0,n.gS)((0,n.rJ)(o.db,"tickets"),{...C,prioridade:(null===(e=C.prioridade)||void 0===e?void 0:e.value)||null,status:(null===(a=C.status)||void 0===a?void 0:a.value)||null,data:C.data||(0,n.O5)()}),alert("Ticket criado com sucesso!"),g(!1)}catch(t){console.error(t),alert("Erro ao criar ticket.")}},children:"Salvar"})]})}),(0,u.jsxs)("div",{className:"d-flex justify-content-between mb-3",children:[(0,u.jsx)("button",{className:"btn btn-success",onClick:()=>{k(null);const e=o.j.currentUser;y({nome:(null===e||void 0===e?void 0:e.displayName)||"",email:(null===e||void 0===e?void 0:e.email)||"",problema:"",prioridade:null,status:null,tecnico:"",data:new Date}),g(!0)},children:"+ Novo Ticket"}),(0,u.jsx)("button",{className:"btn btn-danger",onClick:()=>(0,r.KC)(b),children:"Exportar CSV"})]}),(0,u.jsx)(s.zp,{columns:w,data:b,enablePagination:!0,initialState:{pagination:{pageSize:5}},muiTableProps:{className:"table-striped table-hover"},enableSorting:!0})]})}var h=t(1434);function p(e){let{setTicketSelecionado:a}=e;const t=(0,l.Zp)(),{userData:s}=(0,h.J)(),c="funcionario"===(null===s||void 0===s?void 0:s.tipo),[d,m]=(0,i.useState)([]),[v,p]=(0,i.useState)(""),[x,f]=(0,i.useState)(""),[g,j]=(0,i.useState)(null),[k,C]=(0,i.useState)(null),[y,w]=(0,i.useState)(null),[S,N]=(0,i.useState)(null),[T,D]=(0,i.useState)(null);(0,i.useEffect)(()=>{const e=setTimeout(()=>{f(v.trim().toLowerCase())},500);return()=>clearTimeout(e)},[v]),(0,i.useEffect)(()=>{const e=(0,n.aQ)((0,n.rJ)(o.db,"tickets"),e=>{const a=e.docs.map(e=>{var a,t;return{id:e.id,...e.data(),data:(null===(a=e.data().data)||void 0===a||null===(t=a.toDate)||void 0===t?void 0:t.call(a))||new Date}});m(a)});return()=>e()},[]);const A=(0,i.useCallback)(async e=>{try{await(0,n.kd)((0,n.H9)(o.db,"tickets",e)),alert("Ticket exclu\xeddo com sucesso")}catch(a){console.log(a)}},[]),P=(0,i.useCallback)(async(e,a,t)=>{try{const i=(0,n.H9)(o.db,"tickets",e);await(0,n.mZ)(i,{[a]:t})}catch(i){console.error(`Erro ao atualizar ${a}:`,i)}},[]),E=(0,i.useMemo)(()=>(0,r.iv)(d,{searchTerm:x,filtroStatus:g,filtroPrioridade:k,filtroDataInicial:y,filtroDataFinal:S,filtroTecnico:T}),[d,x,g,k,y,S,T]);return(0,u.jsx)(b,{setTicketSelecionado:a,navigate:t,ticketsFiltrados:E,atualizarCampo:P,excluirTicket:A,isFuncionario:c})}},9847:(e,a,t)=>{t.d(a,{$G:()=>l,BA:()=>n,FJ:()=>o,KC:()=>s,iv:()=>r});t(7762),t(4857);var i=t(2450);const l=[{value:"urgente",label:"Urgente"},{value:"alta",label:"Alta"},{value:"media",label:"M\xe9dia"},{value:"baixa",label:"Baixa"}],o=[{value:"aberto",label:"Aberto"},{value:"em_andamento",label:"Em andamento"},{value:"resolvido",label:"Resolvido"},{value:"cancelado",label:"Cancelado"}],n=[{value:"joao",label:"Jo\xe3o"},{value:"ana",label:"Ana"},{value:"maria",label:"Maria"}];function r(e,a){const{searchTerm:t,filtroStatus:i,filtroPrioridade:l,filtroDataInicial:o,filtroDataFinal:n,filtroTecnico:r}=a;return e.filter(e=>{var a,s,c;const d=(null===t||void 0===t?void 0:t.toLowerCase())||"",u=!d||(null===(a=e.nome)||void 0===a?void 0:a.toLowerCase().includes(d))||(null===(s=e.problema)||void 0===s?void 0:s.toLowerCase().includes(d))||(null===(c=e.email)||void 0===c?void 0:c.toLowerCase().includes(d)),m=!i||e.status===i.value,v=!l||e.prioridade===l.value,b=(!o||e.data>=o)&&(!n||e.data<=n),h=!r||e.tecnico===r.value;return u&&m&&v&&b&&h})}function s(e){const a=e.map(e=>{var a,t;return[e.nome,e.email||"",e.problema,e.prioridade,e.status,e.tecnico,(null===(a=e.data)||void 0===a||null===(t=a.toLocaleDateString)||void 0===t?void 0:t.call(a))||""]}),t=[["Nome","Email","Problema","Prioridade","Status","T\xe9cnico","Data"].join(","),...a.map(e=>e.map(c).join(","))].join("\n"),l=new Blob([t],{type:"text/csv;charset=utf-8;"});(0,i.saveAs)(l,"tickets.csv")}function c(e){return"string"===typeof e&&(e.includes(",")||e.includes('"')||e.includes("\n"))?`"${e.replace(/"/g,'""')}"`:null!==e&&void 0!==e?e:""}}}]);
//# sourceMappingURL=996.eb8b2181.chunk.js.map